<!doctype html>
<html>
<head>
<title>Mmvp Demo</title>

<script type='text/javascript' src='../underscore.min.js'></script>
<script type='text/javascript' src='../mmvp.js'></script>

<script type='text/javascript' src='js/lib/zepto.js'></script>
<script type='text/javascript' src='js/lib/shCore.js'></script>
<script type='text/javascript' src='js/lib/shBrushJScript.js'></script>
<script type='text/javascript' src='js/todo.js'></script>
<script type='text/javascript' src='js/demo_page.js'></script>

<link rel='stylesheet' href='css/style.css' />
<link rel='stylesheet' href='css/shCoreDefault.css' />
</head>

<body>
<main>
<h1>Mmvp.js</h1>
<span class='subline'>(&micro;) model view presenter library</span>

<section id="overview">
  <h2>Abstract</h2>
  <p><a href="#">Mmvp.js</a> is an micro-MVP library which understands the view as ephemeral&hellip; exclusivly concieved &amp; manipulated through callbacks.  Accordingly, all your DOM manipulation, templating, &amp; animation logic lives in several presenter's callbacks (<code>empty</code>, <code>populate</code>, <code>add</code>, <code>remove</code>, &amp; <code>update</code>).</p>

  <p>When the model is modified, the corresponding presenter callback(s) are triggered. <a href="#">Mmvp.js</a> belives M&rarr;V architecture itself should be completly decoupled from the DOM.  Infact, Mmv(P).js, on its own, does not even know the DOM exists.  P framework exists simply to bind V-generating callbacks to model changes.</p>
</section>
<section id="demo">
  <h2>Demo</h2>
  <p>Here's the archetypal TodoMVC demo using Mmvp.js. The <a id='todo-src' href="#">demo code</a> (56 SLOC) for it's implementation is slightly heavier than the <a id='mmvp-src' href="#">Mmvp.js framework code</a> itself (44 SLOC).</p>
  <nav><h3 class='view active'>View</h3><h3 class='model'>Model</h3></nav>
  <section id='switcher'> 
    <section class='view active'>  
      <div id="viewpen"></div>
      <div id='newitem'>
        <span class='hint'>&raquo;</span>
        <input type='text' placeholder='Item Name'>
      </div>
    </section>
    <section class='model'>
      <pre class='brush: js; toolbar: false;'>
      </pre>
    </section>
  </section>
</section>


<div id='code'>
  <link rel='stylesheet' href='css/style.css' />
  <link rel='stylesheet' href='css/shCoreDefault.css' />
  <link rel='stylesheet' href='css/source.css' />
  <nav><h3 class='todo'>Todo.js</h3><h3 class='mmvp'>Mmvp.js</h3></nav>
  <section class='source mmvp'>
    <a href="">plain</a>
    <pre class='brush: js; toolbar: false;'>
var Mmvp = (function(my) {
  var actions = {
    add      : function() {},
    remove   : function() {},
    update   : function() {},
    populate : function() {},
    empty    : function() {}
  }, 
  model = {};

  function sync(hash_with_unique_keys) { 
    var add_items = _.omit(hash_with_unique_keys, _.keys(model));
    var remove_itemsdemo = _.omit(model, _.keys(hash_with_unique_keys));

    _.each(_.pick(model, _.keys(hash_with_unique_keys)), function(v,k) {
      _.each(_.keys(model[k]), function(key) {
        if (model[k][key] != hash_with_unique_keys[k][key]) {
          model[k] = hash_with_unique_keys[k];
          actions['update'](k,model[k]);
          return;
        }
      });
    });

    if (_.size(hash_with_unique_keys) == 0 && _.size(model) != 0) { actions['empty'](); }
    if (_.size(model) == 0 && _.size(hash_with_unique_keys) != 0) { actions['populate'](); }

    _.each(add_items, function(value, key) { actions['add'](key, value); });
    _.each(remove_items, function(value, key) { actions['remove'](key, value) });

    model = _.clone(hash_with_unique_keys);
    return true;
  }
  return {
    initialize : function() { actions.empty(); },
    set_action : function(new_hash) {
      if (actions['add']) { actions.add = new_hash.add; }
      if (actions['remove']) { actions.remove = new_hash.remove; }
      if (actions['populate']) { actions.populate = new_hash.populate; }
      if (actions['empty']) { actions.empty = new_hash.empty; }
    },
    sync : sync
  };
});
    </pre>
  </section>
  <section class='source todo'>
    <a href="">plain</a>
    <pre class='brush: js; toolbar: false;'>
// uuid sourced from: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript
function uuid() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
    return v.toString(16);
  });
}
var todo_model = {}, presenter_dom_identifier = "#viewpen"; var presenter = new Mmvp();
presenter.set_action({
  empty : function() {
    $("#items-container").remove();
    $(presenter_dom_identifier).append(
      "&lt;div id='no-items'&gt;&lt;h3&gt;No Items!&lt;/h3&gt;&lt;p&gt;Hint: Add a new item.&lt;/p&gt;&lt;/div&gt;"
    );
    $("#no-items").animate({opacity : 1 }, 300, 'ease-in');
  },
  populate : function() {
    $("#no-items").remove(); 
    $(presenter_dom_identifier).append("&lt;div id='items-container'&gt;&lt;/div&gt;");
  },
  add : function(new_model_key, new_model_value) {
    var checked = new_model_value == true ? "checked" : "";
    var new_div = $("&lt;div&gt;&lt;input type='checkbox' " + checked + "&gt;&lt;span&gt;" + new_model_value.text + "&lt;/span&gt;&lt;/div&gt;");
    new_div.attr('id', new_model_key).prepend(
      $("&lt;button class='remove'&gt;&#150;&lt;/button&gt;")
    );
    $("#items-container").prepend(new_div);
    new_div.animate({ opacity: 1 }, 300, 'ease-in');
  },
  remove : function(key_of_removed_item) {
    $("#" + key_of_removed_item).remove();
  },
  update : function(key_of_updated_model) {
    console.log("RUNNINg update action");
  }
});
// Zepto's version of document.onload
$(function() {
  presenter.initialize();

  $(document).on("click", "button.remove", function(ev) {
    delete todo_model[$(ev.target).parent().attr('id')];
    presenter.sync(todo_model);
  });
  $(document).on("click", "input[type='checkbox']", function(ev) {
    var is_checked = $(ev.target).is(":checked");
    todo_model[$(ev.target).parent().attr("id")]['checked'] = is_checked;
    presenter.sync(todo_model);
  });
  $("button#clear").on("click", function() {
    presenter.sync(todo_model = {});
  });
  $("input").on("keypress", function(ev) {
    if (ev.which == 13) {
      var u = uuid();
      todo_model[u] = { 
        text    : $("input[type='text']").val(), 
        checked : false 
      };
      $("input").val("");
      presenter.sync(todo_model);
    }
  });
});
    </pre>
  </section>
</div>

</body>
</html>
